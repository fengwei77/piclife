<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=1">
    <title>保誠人壽|麻吉養生館</title>
    <meta name="keywords" content="保誠人壽|麻吉養生館"/>
    <meta name="description" content="保誠人壽|麻吉養生館">
    <meta property="og:title" content="保誠人壽|麻吉養生館"/>
    <meta property="og:site_name" content="保誠人壽|麻吉養生館"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="">

    <!-- Favicon -->
    <link rel="shortcut icon" href="" type="image/png">
    <link rel="apple-touch-icon" sizes="76x76" href=""/>
    <link rel="apple-touch-icon" sizes="120x120" href=""/>
    <link rel="apple-touch-icon" sizes="152x152" href=""/>
    <!-- Style css -->
    <link href="assets/css/normalize.css" rel="stylesheet" media="all">
    <link href="assets/css/style.css" rel="stylesheet" media="all">
    <!-- animate css -->
    <link href="assets/css/animate.min.css" rel="stylesheet">

    <!-- hover css -->
    <link href="assets/css/hover.css" rel="stylesheet">

</head>
<body class="advance-bg" x-data="qData">
<div id="test-width" style="position: fixed; top: 0px; left: 0px; color: rgba(0, 0, 0, 0.3); z-index: 999;"></div>

<div class="illegal-mask">請將瑩幕調整為適合尺寸</div>

<div class="maintain-edge">

    <!--logo start-->
    <div class="logo"><a href="index.html"><img src="assets/images/logo.png"></a></div>
    <!--logo end-->

    <!--cabinet start-->
    <div class="cabinet"><img src="assets/images/cabinet.png"></div>
    <!--藥櫃 end-->

    <!--checkout  start-->
    <div class="checkout">
        <div class="checkstand">
            <div class="protagonist"><img src="assets/images/protagonist.png"></div>
            <div class="top"></div>
            <div class="bottom"></div>
        </div>
    </div>
    <!--藥櫃 end-->
    <!--examination.png start-->
    <template x-for="question in questions_axios" :key="question.id">
        <div x-show="question.id == 1" class="examination">
            <img src="assets/images/examination.png">
            <div class="question">
                <img x-bind:src="'assets/images/'+question.q_img+'.png'"/>
            </div>
            <template x-for="op in answer_limit">
                <div class="item" :class="'item-'+op">
                    <div class="answer" x-on:click="triggerChs(question.id,op)"
                         x-data="{ currentId: `item_${question.id}_${op}`}"
                         x-bind:id="currentId" :class="chs_option[question.id][op]">
                        <img x-bind:src="'assets/images/'+question.a_img+op+'.png'"/>
                    </div>
                </div>
            </template>
        </div>
    </template>

    <!--examination.png end-->


</div>

<footer>
    <div class="txt-block">
        <img src="assets/images/footer_txt_desktop.png" class="lihsi-desktop"><img
            src="assets/images/footer_txt_mobile.png" class="lihsi-mobile">
    </div>
</footer>

<template x-for="question in questions_axios" :key="question.id">
    <!--            <div x-html="question.id + '-' + question.content"></div>-->
    <div class="text-left">
        <span x-text="question.id"></span>
        <span x-text=" question.content" :key="question.id"></span>
        <template x-for="option in options" :key="option">
            <input type="radio" :value="option"
                   :id="'option' + option"
                   :name="'option'+question.id"
                   x-on:click="selectedOption[parseInt(question.id)-1] = option"
                   x-model="selectedOption[parseInt(question.id)-1] "
                   class="w-4 h-4 mx-1 px-5 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
        </template>


    </div>
</template>
<div>
    <p>Selected option: <span x-text="selectedOption"></span></p>
    <!--        <template x-for="ans in [1,2,3,4,5]" :key="ans">-->
    <!--            <input type="radio"  x-model="ans">-->
    <!--        </template>-->
    <button class="mb-5 mx-3 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
            @click="send(selectedOption)">送出
    </button>
    <p>體質: <span x-text="person_type"></span></p>

    <!--        <p>錯誤訊息: <span x-text="error"></span></p>-->

    <p>目前節氣: <span x-text="current_solar_term"></span></p>
    <div x-show="open"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-90"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-300"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-90"
    >
        <p>調養: <span x-text="care_body"></span></p>
        <p>穴位按摩: <span x-text="acupuncture_points"></span></p>
    </div>
</div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="assets/js/jquery-3.6.3.min.js"></script>

<script src="assets/js/lihsi.js"></script>
<!-- question action plugins  -->
<script defer src="https://unpkg.com/alpinejs@3.11.1/dist/cdn.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script type="text/javascript" src="js/luneTerm.js"></script>
<script type="text/javascript" src="js/24term.js"></script>

<script>
    var data;
    var cart_tree = {
        data: [
            {
                "type": "A",
                "item": "3",
                "base_line": "3.5",
                "lt": ["A", "5"],
                "gt": ["C", "3"],
            },
            {
                "type": "A",
                "item": "5",
                "base_line": "1.5",
                "lt": ["A", "0"],
                "gt": ["D", "9"]
            },
            {
                "type": "D",
                "item": "9",
                "base_line": "4.5",
                "lt": ["D", "4"],
                "gt": ["I", "0"]
            },
            {
                "type": "D",
                "item": "4",
                "base_line": "2.5",
                "lt": ["B", "7"],
                "gt": ["D", "10"]
            },
            {
                "type": "B",
                "item": "7",
                "base_line": "2.5",
                "lt": ["A", "2"],
                "gt": ["G", "0"]
            },
            {
                "type": "A",
                "item": "2",
                "base_line": "1.5",
                "lt": ["A", "0"],
                "gt": ["B", "0"]
            }
            ,
            {
                "type": "D",
                "item": "10",
                "base_line": "3.5",
                "lt": ["D", "5"],
                "gt": ["J", "7"]
            },
            {
                "type": "D",
                "item": "5",
                "base_line": "3.5",
                "lt": ["D", "0"],
                "gt": ["E", "0"]
            },
            {
                "type": "J",
                "item": "7",
                "base_line": "3.5",
                "lt": ["G", "0"],
                "gt": ["J", "0"]
            }
            ,
            {
                "type": "C",
                "item": "3",
                "base_line": "4.5",
                "lt": ["C", "0"],
                "gt": ["C", "8"]
            }
            ,
            {
                "type": "C",
                "item": "8",
                "base_line": "3.5",
                "lt": ["C", "10"],
                "gt": ["H", "0"]
            }
            ,
            {
                "type": "C",
                "item": "10",
                "base_line": "3.5",
                "lt": ["C", "6"],
                "gt": ["J", "0"]
            }
            ,
            {
                "type": "C",
                "item": "6",
                "base_line": "3.5",
                "lt": ["C", "0"],
                "gt": ["F", "0"]
            }
        ]
    };
    let result;

    // async function questions_axios() {
    //     let response = await axios.get('js/constitution.json')
    //         .then(function (response) {
    //             return response.data.questions;
    //         });
    //     return await response
    // }

    document.addEventListener('alpine:init', () => {
        Alpine.data('qData', () => ({
            answer_limit: 5,
            open: false,
            no: 0,
            selectedOption: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            chs_option: [
                ['0', '--', '--', '--', '--', '--'],
                ['1', '', '', '', '', ''],
                ['2', '', '', '', '', ''],
                ['3', '', '', '', '', ''],
                ['4', '', '', '', '', ''],
                ['5', '', '', '', '', ''],
                ['6', '', '', '', '', ''],
                ['7', '', '', '', '', ''],
                ['8', '', '', '', '', ''],
                ['9', '', '', '', '', ''],
                ['10', '', '', '', '', '']],
            all_types: null,
            options: [1, 2, 3, 4, 5],
            error: '',
            person_type: "",
            current_solar_term: "",
            care_body: "content",
            acupuncture_points: "ap content",
            init() {
                var today = new Date();
                this.current_solar_term = getjq(today.getFullYear(), (today.getMonth() + 1), today.getDate());
                console.log(cart_tree.data);
                console.log(this.selectedOption);
                console.log(this.chs_option);

                axios.get('js/constitution.json')
                    .then(function (response) {
                        this.all_types = response.data.types;
                        // console.log(this.all_types);
                    });
            },
            triggerChs(group, id) {
                console.log(group);
                let i = 1;
                while (i <= 5){
                    this.chs_option[group][i] = '';
                    i++;
                }
                this.chs_option[group][id] = 'chs';
                console.log(this.chs_option);
            },
            get_current_solar_term() {
                var today = new Date();
                this.current_solar_term = getjq(today.getFullYear(), (today.getMonth() + 1), today.getDate());
                console.log(cart_tree.data);
                console.log(this.selectedOption);
            },
            gen_name(name, id) {
                console.log(name + "_" + id);
                return name + "_" + id;
            },
            async questions_axios() {
                let response = await axios.get('js/constitution.json')
                    .then(function (response) {
                        return response.data.questions;
                    });

                return await response;
            },
            get_all_type() {
                axios.get('js/constitution.json')
                    .then(function (response) {
                        this.all_types = response.data.types;
                        // console.log(this.all_types);
                    })
            },
            async get_condition(pt, term) {
                let response = await axios.get('js/condition.json')
                    .then(function (response) {
                        data = response.data;
                        let jsonData = JSON.parse(JSON.stringify(data));
                        let getCond = jsonData[pt];
                        let prev_cate = '';
                        let prev_desc = '';
                        return getCond;
                    });

                return await response;
            },
            send() {
                this.care_body = '';
                this.acupuncture_points = '';
                this.open = !this.open;
                let next_id = 'A';
                let ques_id = "3";
                let tier = 0;
                let item_pos = parseInt(cart_tree.data[tier].item) - 1;
                while (tier < 6) {
                    if (ques_id > 0) {
                        resultObject = search(next_id, ques_id, cart_tree.data);
                        item_pos = parseInt(resultObject.item) - 1;
                        console.log('resultObject:');
                        console.log(resultObject);
                        console.log(`item ${ques_id}: ${this.selectedOption[item_pos]}`)
                        if (this.selectedOption[item_pos] > resultObject.base_line) {
                            next_id = resultObject.gt[0];
                            ques_id = resultObject.gt[1];
                        } else {
                            next_id = resultObject.lt[0];
                            ques_id = resultObject.lt[1];
                        }
                        console.log(`tier ${tier} 結果是 ${next_id} :　${ques_id}`)
                        if (ques_id == 0) {
                            break;
                        }
                    }
                    tier += 1;
                }
                if (ques_id == 0) {
                    let type_arr = search_type(next_id, all_types);
                    console.log(type_arr);
                    this.person_type = type_arr.title;
                    console.log(`[0] tier ${tier} 結果是 ${next_id} :　${ques_id}`)

                    console.log(this.person_type);
                    (async () => {
                        result = await this.get_condition(this.person_type, this.current_solar_term);
                        console.log(result);

                        let prev_cate = '';
                        let prev_desc = '';
                        let prev_cont = '';

                        for (let i = 0; i < result.length; i++) {
                            if (prev_cate != result[i]['症狀類別']) {
                                prev_cate = result[i]['症狀類別'];
                                console.log('症狀類別:' + result[i]['症狀類別']);
                            }
                            if (prev_desc != result[i]['症狀描述']) {
                                prev_desc = result[i]['症狀描述'];
                                console.log('症狀描述:' + result[i]['症狀描述']);
                            }
                            if (prev_cont != result[i]['衛教內容']) {
                                prev_cont = result[i]['衛教內容'];
                                console.log('衛教內容:' + result[i]['衛教內容']);
                                if (result[i]['衛教內容'] == '飲食調養') {

                                    if (prev_cont != result[i][this.current_solar_term]) {
                                        prev_cont = result[i][this.current_solar_term];
                                        console.log(this.current_solar_term + ':' + result[i][this.current_solar_term]);
                                        this.care_body = prev_cont;
                                    }
                                }
                                if (result[i]['衛教內容'] == '穴位調養') {

                                    if (prev_cont != result[i][this.current_solar_term]) {
                                        prev_cont = result[i][this.current_solar_term];
                                        console.log(this.current_solar_term + ':' + result[i][this.current_solar_term]);
                                        this.acupuncture_points = prev_cont;
                                    }
                                }
                            }
                        }

                    })();


                }

                for (const value of this.selectedOption) {
                    console.log(value);
                    if (value == 0) {
                        this.error = '有問題尚未回答!';
                        break;
                    } else {
                        this.error = '';
                    }
                }
            }

        }))
    })

    function search(key1, key2, myArray) {
        for (var i = 0; i < myArray.length; i++) {
            if (myArray[i].type === key1 && myArray[i].item === key2) {
                return myArray[i];
            }
        }
    }

    function search_type(key1, myArray) {
        for (var i = 0; i < myArray.length; i++) {
            if (myArray[i].id === key1) {
                return myArray[i];
            }
        }
    }
</script>
</body>
</html>